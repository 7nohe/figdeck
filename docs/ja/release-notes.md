# リリースノート

## [1.3.0] - 2025-12-07

### 新機能

#### Figma リンクのリッチテキスト対応
Figma リンクブロックのテキストオーバーライドでリッチテキスト書式をサポートしました。

**対応書式:**
- `**太字**`
- `*斜体*`
- `~~取り消し線~~`
- `[リンク](url)`
- 箇条書きリスト
- 引用

**使用例:**
```markdown
:::figma
link=https://www.figma.com/design/xxx?node-id=1234-5678
text.title=カート機能
text.body=**カート**と*確認*フローに使用します。
text.list=
  - バリエーション A
  - バリエーション B
:::
```

#### 箇条書きの行間カスタマイズ
箇条書きリストのアイテム間隔を `spacing` プロパティでカスタマイズできるようになりました。

**使用例:**
```yaml
---
bullets:
  size: 20
  spacing: 12  # アイテム間のギャップ（ピクセル）
---
```

#### キャッシュとパフォーマンス最適化
スライド生成のパフォーマンスを大幅に改善しました。

**主な改善:**
- ローカル画像のキャッシュ機能を追加（同じ画像の再読み込みを回避）
- Figma ノードのキャッシュ機能を追加（再生成時の効率化）
- コードブロックのシンタックスハイライトをキャッシュ
- ハッシュベースの変更検出による差分更新

#### Plugin UI の改善
接続オプションの詳細設定をトグルで表示/非表示できるようになりました。デフォルトではシンプルな接続画面を表示し、必要に応じて詳細オプション（ホスト、ポート、シークレット）を展開できます。

### 修正

#### ハイパーリンクのレンダリング問題を修正
Figma Slides でのハイパーリンクが正しくレンダリングされない問題を修正しました。テキスト内のリンクが正しく認識され、クリック可能になります。

### 改善

#### テキストレンダリングの強化
複数行にまたがるテキストスパンとインラインコードの処理を改善しました。

#### 共有パッケージの導入
CLI と Plugin 間で共有される型定義とユーティリティを `@figdeck/shared` パッケージに抽出しました。これにより、コードの重複が削減され、保守性が向上しました。

### ドキュメント
- Figma プラグインのインストール手順を README に追加
- WebSocket 接続要件の説明を追加
- Figma リンクのリッチテキスト対応ドキュメントを追加
- 箇条書きの行間カスタマイズのドキュメントを追加

### テスト
- Figma リンクのリッチテキストパース処理のテストを追加
- ハイパーリンクレンダリングのテストを追加
- ローカル画像キャッシュのテストを追加
- ハッシュ関数のテストを追加

## [1.2.1] - 2025-12-05

### 改善
- **ネストされた箇条書きリストの機能強化**: 順序付きリストのメタデータを保持するように改善しました。これにより、順序付きリストと順序なしリストが混在するネストされたリストでも、正しく順序情報が保持されます。

## [1.2.0] - 2025-12-05

### 新機能

#### カスタムフォント設定
YAML フロントマターでフォントファミリーとバリアントを設定できるようになりました。見出し（h1, h2）、本文、箇条書き、コードブロックごとに個別にフォントを設定可能です。

**主な機能:**
- フォントファミリーのカスタマイズ
- フォントバリアント（Regular, Bold, Italic, Bold Italic）の個別設定
- ショートハンド記法とフル設定の両方に対応
- フォントが利用できない場合の自動フォールバック

**使用例:**
```yaml
---
fonts:
  h1:
    family: "Roboto"
    style: "Medium"        # 基本スタイル
    bold: "Bold"           # 太字バリアント
    italic: "Italic"       # 斜体バリアント
    boldItalic: "Bold Italic"  # 太字斜体バリアント
  h2: "Open Sans"          # ショートハンド記法（"Regular" を使用）
  body:
    family: "Source Sans Pro"
    style: "Regular"
    bold: "Semibold"       # カスタム太字バリアント
  bullets:
    family: "Inter"
    style: "Regular"
  code:
    family: "Fira Code"
    style: "Regular"
---
```

詳細は `examples/fonts.md` を参照してください。

#### バージョン互換性チェック
CLI と Plugin 間の通信にプロトコルバージョニングを導入し、バージョン不一致を検出できるようになりました。

**主な機能:**
- WebSocket 接続時の自動バージョンチェック
- Plugin UI でのバージョン不一致警告表示
- CLI が `package.json` からバージョンを自動読み取り
- 互換性のあるバージョン間での通信を保証

**動作:**
- CLI と Plugin が接続時にバージョン情報を交換
- メジャーバージョンが異なる場合、警告を表示
- マイナーバージョンやパッチバージョンの違いは許容

#### 画像サイズ指定（Marp スタイル）
画像にサイズ指定を追加できるようになりました。幅・高さの個別指定、固定サイズ、パーセンテージ指定に対応しています。

**対応形式:**
- `![w:400](./image.png)` - 幅 400px（高さは自動計算、アスペクト比を維持）
- `![h:300](./image.png)` - 高さ 300px（幅は自動計算、アスペクト比を維持）
- `![w:400 h:300](./image.png)` - 固定サイズ 400x300px
- `![w:50%](./image.png)` - スライド幅の 50%（スライド幅は 1920px）
- `![w:400 Logo](./image.png)` - サイズ指定 + alt テキスト

詳細は `examples/images.md` を参照してください。

#### ネストされた箇条書きリスト
複数レベルのネストされた箇条書きリストに対応しました。各レベルで異なるマーカーを使用し、視覚的に階層を表現します。

**主な機能:**
- 最大 4 レベルまでのネストに対応
- 各レベルで異なるマーカー（•, ◦, ▪, –）
- 順序付きリストと順序なしリストが混在に対応
- インライン書式（太字、斜体、コード、リンク）のサポート

**マーカー:**
- Level 0: `•` (U+2022)
- Level 1: `◦` (U+25E6)
- Level 2: `▪` (U+25AA)
- Level 3+: `–` (U+2013)

**使用例:**
```markdown
- Level 0 item
  - Level 1 item (2 スペースでインデント)
  - Another level 1 item
    - Level 2 item
    - Another level 2 item
      - Level 3 item
- Back to level 0
```

詳細は `examples/bullets.md` を参照してください。

### 改善

#### 依存関係の更新
- esbuild を 0.27.1 に更新し、互換性とパフォーマンスを向上

#### ビルド設定の最適化
- Plugin のビルドターゲットを ES2016 に調整し、Figma Plugin のサンドボックス環境との互換性を確保
- モダンな JavaScript 構文の自動トランスパイルを改善

### ドキュメント
- カスタムフォント設定の詳細なドキュメントを追加（英語・日本語）
- 画像サイズ指定の使用例とドキュメントを追加
- ネストされた箇条書きリストの仕様と使用例を追加
- バージョン互換性に関する説明を追加
- `CLAUDE.md` に新機能の説明を追加

### テスト
- カスタムフォント設定の包括的なテストを追加
- 画像サイズ指定のテストを追加
- ネストされた箇条書きリストのテストを追加
- バージョン互換性チェックのテストを追加
